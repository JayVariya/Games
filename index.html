<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ValoAim Trainer</title>
    <style>
        :root {
            --bg-color: #0f1923;
            --panel-color: #1f2731;
            --accent-color: #ff4655;
            --text-color: #ece8e1;
            --target-color: #00ffff;
            --green-color: #16e5b4;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            user-select: none;
        }

        #ui-layer, #end-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .hud-top {
            display: flex;
            justify-content: space-between;
            padding: 20px 40px;
            font-weight: bold;
            font-size: 1.5rem;
            text-transform: uppercase;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .stat-box span {
            color: var(--accent-color);
            margin-left: 10px;
        }

        #menu-screen, #end-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 25, 35, 0.98);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
            z-index: 20;
        }

        #end-screen { display: none; }

        h1 {
            font-size: 4rem;
            margin-bottom: 10px;
            letter-spacing: 5px;
            text-transform: uppercase;
            color: var(--text-color);
            border-bottom: 4px solid var(--accent-color);
        }

        .subtitle {
            margin-bottom: 40px;
            color: #8b9bb4;
        }

        .controls-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .mode-select {
            display: flex;
            gap: 20px;
        }

        .btn {
            background: var(--panel-color);
            color: var(--text-color);
            border: 1px solid #333;
            padding: 15px 40px;
            font-size: 1.2rem;
            cursor: pointer;
            text-transform: uppercase;
            font-weight: bold;
            transition: all 0.2s;
            min-width: 200px;
        }

        .btn:hover {
            background: var(--accent-color);
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .setting-box {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0,0,0,0.3);
            padding: 10px 20px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        input[type="number"] {
            background: transparent;
            border: none;
            border-bottom: 2px solid var(--accent-color);
            color: white;
            font-size: 1.2rem;
            width: 60px;
            text-align: center;
        }
        input[type="number"]:focus { outline: none; }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 40px;
            text-align: center;
        }

        .result-card {
            background: var(--panel-color);
            padding: 20px;
            border: 1px solid #333;
            min-width: 200px;
        }

        .result-label { color: #8b9bb4; font-size: 0.9rem; text-transform: uppercase; }
        .result-val { font-size: 2.5rem; font-weight: bold; color: white; }
        .high-score-notify { color: var(--green-color); font-size: 0.9rem; margin-top: 5px; opacity: 0; }

        canvas { display: block; cursor: none; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="hud-top" id="hud" style="display: none;">
            <div class="stat-box">Score:<span id="score-display">0</span></div>
            <div class="stat-box">Time:<span id="time-display">60</span></div>
            <div class="stat-box">Acc:<span id="acc-display">100%</span></div>
        </div>
    </div>

    <div id="menu-screen">
        <h1>VALOAIM</h1>
        <p class="subtitle">Select a task to lock mouse and start</p>
        
        <div class="setting-box">
            <label>SENSITIVITY:</label>
            <input type="number" id="sens-input" value="0.7" step="0.05" min="0.1">
        </div>

        <div class="mode-select">
            <button class="btn" onclick="initGame('gridshot')">Gridshot</button>
            <button class="btn" onclick="initGame('spidershot')">Spidershot</button>
            <button class="btn" onclick="initGame('spray')">Spray Control</button>
        </div>
        <p style="margin-top: 30px; font-size: 0.8rem; color: gray;">Press ESC to pause/unlock mouse</p>
    </div>

    <div id="end-screen">
        <h1>SESSION COMPLETE</h1>
        
        <div class="results-grid">
            <div class="result-card">
                <div class="result-label">Total Score</div>
                <div class="result-val" id="end-score">0</div>
                <div class="high-score-notify" id="new-hs-label">NEW HIGH SCORE!</div>
            </div>
            <div class="result-card">
                <div class="result-label">Accuracy</div>
                <div class="result-val" id="end-acc">0%</div>
            </div>
            <div class="result-card">
                <div class="result-label">High Score</div>
                <div class="result-val" id="end-hs">0</div>
            </div>
            <div class="result-card">
                <div class="result-label">Targets Hit</div>
                <div class="result-val" id="end-hits">0</div>
            </div>
        </div>

        <div class="mode-select">
            <button class="btn" onclick="restartSameMode()">Play Again</button>
            <button class="btn" onclick="returnToMenu()">Menu</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    const scoreEl = document.getElementById('score-display');
    const timeEl = document.getElementById('time-display');
    const accEl = document.getElementById('acc-display');
    const menuScreen = document.getElementById('menu-screen');
    const endScreen = document.getElementById('end-screen');
    const hud = document.getElementById('hud');
    const sensInput = document.getElementById('sens-input');

    const endScoreEl = document.getElementById('end-score');
    const endAccEl = document.getElementById('end-acc');
    const endHsEl = document.getElementById('end-hs');
    const endHitsEl = document.getElementById('end-hits');
    const newHsLabel = document.getElementById('new-hs-label');

    let sensitivity = 0.7; 
    let isPlaying = false;
    let gameMode = 'gridshot';
    let score = 0;
    let shotsFired = 0;
    let shotsHit = 0;
    let timeLeft = 60;
    let lastTime = 0;
    let targets = [];
    let mouse = { x: window.innerWidth / 2, y: window.innerHeight / 2 }; 
    let isMouseDown = false;
    let recoilOffset = { x: 0, y: 0 };
    let recoilFrame = 0;

    let highScores = JSON.parse(localStorage.getItem('valoAimHighScores')) || {
        gridshot: 0,
        spidershot: 0,
        spray: 0
    };

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        mouse.x = canvas.width / 2;
        mouse.y = canvas.height / 2;
    }
    window.addEventListener('resize', resize);
    resize();

    function initGame(mode) {
        gameMode = mode;
        sensitivity = parseFloat(sensInput.value) || 0.7; 
        
        canvas.requestPointerLock = canvas.requestPointerLock || canvas.mozRequestPointerLock;
        canvas.requestPointerLock();
    }

    document.addEventListener('pointerlockchange', lockChangeAlert, false);
    document.addEventListener('mozpointerlockchange', lockChangeAlert, false);

    function lockChangeAlert() {
        if (document.pointerLockElement === canvas || document.mozPointerLockElement === canvas) {
            if (!isPlaying) startGame();
        } else {
            if (timeLeft > 0) {
                stopGame(); 
            }
        }
    }

    document.addEventListener('mousemove', (e) => {
        if (!isPlaying) return;
        mouse.x += e.movementX * sensitivity;
        mouse.y += e.movementY * sensitivity;
        
        mouse.x = Math.max(0, Math.min(canvas.width, mouse.x));
        mouse.y = Math.max(0, Math.min(canvas.height, mouse.y));
    });

    document.addEventListener('mousedown', (e) => {
        if (!isPlaying) return;
        if (e.button === 0) {
            isMouseDown = true;
            fireShot();
        }
    });

    document.addEventListener('mouseup', () => {
        isMouseDown = false;
        recoilFrame = 0;
        recoilOffset = {x:0, y:0};
    });

    function startGame() {
        isPlaying = true;
        score = 0;
        shotsFired = 0;
        shotsHit = 0;
        timeLeft = 60;
        targets = [];
        
        menuScreen.style.display = 'none';
        endScreen.style.display = 'none';
        hud.style.display = 'flex';
        updateHUD();

        if (gameMode === 'gridshot') { spawnTarget(); spawnTarget(); spawnTarget(); }
        else if (gameMode === 'spidershot') { spawnTarget(true); }
        else if (gameMode === 'spray') { spawnTarget(true); }

        lastTime = performance.now();
        requestAnimationFrame(gameLoop);
    }

    function stopGame() {
        isPlaying = false;
        menuScreen.style.display = 'flex';
        endScreen.style.display = 'none';
        hud.style.display = 'none';
    }

    function finishGame() {
        isPlaying = false;
        document.exitPointerLock();
        
        const acc = shotsFired === 0 ? 0 : Math.round((shotsHit / shotsFired) * 100);
        let isNewRecord = false;

        if (score > highScores[gameMode]) {
            highScores[gameMode] = score;
            localStorage.setItem('valoAimHighScores', JSON.stringify(highScores));
            isNewRecord = true;
        }

        endScoreEl.textContent = score;
        endAccEl.textContent = acc + "%";
        endHsEl.textContent = highScores[gameMode];
        endHitsEl.textContent = shotsHit;
        
        newHsLabel.style.opacity = isNewRecord ? 1 : 0;

        hud.style.display = 'none';
        endScreen.style.display = 'flex';
    }

    function restartSameMode() {
        initGame(gameMode);
    }

    function returnToMenu() {
        endScreen.style.display = 'none';
        menuScreen.style.display = 'flex';
    }

    function spawnTarget(isCenter = false) {
        const margin = 100;
        let x, y, radius;

        if (isCenter) {
            x = canvas.width / 2;
            y = canvas.height / 2;
            radius = 25;
        } else {
            x = margin + Math.random() * (canvas.width - margin * 2);
            y = margin + Math.random() * (canvas.height - margin * 2);
            radius = (gameMode === 'gridshot') ? 35 : 20;
        }

        targets.push({
            x: x, y: y, radius: radius,
            color: '#00ffff',
            maxHealth: (gameMode === 'spray') ? 10 : 1,
            health: (gameMode === 'spray') ? 10 : 1,
            isCenter: isCenter,
            scale: 0 
        });
    }

    function fireShot() {
        shotsFired++;
        let hitX = mouse.x + recoilOffset.x;
        let hitY = mouse.y - recoilOffset.y; 
        let hit = false;
        
        for (let i = targets.length - 1; i >= 0; i--) {
            const t = targets[i];
            const dx = hitX - t.x;
            const dy = hitY - t.y;
            const dist = Math.sqrt(dx*dx + dy*dy);

            if (dist < t.radius) {
                hit = true;
                processHit(i);
                break; 
            }
        }
        if (hit) shotsHit++;
        updateHUD();
    }

    function processHit(index) {
        const t = targets[index];
        t.health--;
        t.scale = 1.2; 

        if (t.health <= 0) {
            score += 100;
            targets.splice(index, 1);

            if (gameMode === 'gridshot') spawnTarget();
            else if (gameMode === 'spidershot') {
                if (t.isCenter) spawnTarget(false); 
                else spawnTarget(true);
            } 
            else if (gameMode === 'spray') spawnTarget(true);
        } else {
            score += 10;
        }
    }

    function updateHUD() {
        scoreEl.textContent = score;
        timeEl.textContent = Math.ceil(timeLeft);
        const acc = shotsFired === 0 ? 0 : Math.round((shotsHit / shotsFired) * 100);
        accEl.textContent = acc + "%";
    }

    function gameLoop(timestamp) {
        if (!isPlaying) return;

        const deltaTime = (timestamp - lastTime) / 1000;
        lastTime = timestamp;

        timeLeft -= deltaTime;
        if (timeLeft <= 0) {
            finishGame();
            return;
        }
        updateHUD();

        if (gameMode === 'spray' && isMouseDown) {
            recoilFrame++;
            if (recoilFrame < 10) {
                recoilOffset.y += 3.0; 
            } else {
                recoilOffset.y = Math.min(recoilOffset.y + 0.5, 90); 
                recoilOffset.x = (Math.sin(recoilFrame * 0.4) * 20);
            }
        } else {
            recoilOffset.x = 0;
            recoilOffset.y = 0;
        }

        draw();
        requestAnimationFrame(gameLoop);
    }

    function draw() {
        ctx.fillStyle = '#0f1923';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.strokeStyle = '#1f2731';
        ctx.lineWidth = 1;
        ctx.beginPath();
        for(let i=0; i<canvas.width; i+=100) { ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); }
        for(let i=0; i<canvas.height; i+=100) { ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); }
        ctx.stroke();

        targets.forEach(t => {
            if (t.scale < 1) t.scale += 0.1;
            if (t.scale > 1) t.scale -= 0.05;

            ctx.beginPath();
            ctx.arc(t.x, t.y, t.radius * (t.scale || 1), 0, Math.PI * 2);
            ctx.fillStyle = t.color;
            ctx.fill();
            
            if (gameMode === 'spray') {
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(t.x, t.y, t.radius + 4, 0, (Math.PI * 2) * (t.health / t.maxHealth));
                ctx.stroke();
            }
        });

        const chX = mouse.x;
        const chY = mouse.y;
        const size = 2; 

        ctx.fillStyle = 'white';
        ctx.beginPath();
        ctx.arc(chX, chY, size, 0, Math.PI * 2);
        ctx.fill();

        ctx.strokeStyle = 'black';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.arc(chX, chY, size, 0, Math.PI * 2);
        ctx.stroke();

        if (gameMode === 'spray' && isMouseDown) {
            const impactX = mouse.x + recoilOffset.x;
            const impactY = mouse.y - recoilOffset.y;
            
            ctx.fillStyle = 'rgba(255, 70, 85, 0.5)';
            ctx.beginPath();
            ctx.arc(impactX, impactY, 3, 0, Math.PI*2);
            ctx.fill();
        }
    }
</script>
</body>
</html>